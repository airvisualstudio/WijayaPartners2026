---
import { createReader } from '@keystatic/core/reader';
import keystaticConfig from '../../keystatic.config';
import Layout from '../layouts/main.astro';
import { Hero } from '@/components/Hero';
import { Features } from '@/components/Features';
import { Pricing } from '@/components/Pricing';
import { Testimonials } from '@/components/Testimonials';
import { FAQ } from '@/components/FAQ';

const reader = createReader(process.cwd(), keystaticConfig);
const homepageData = await reader.singletons.homepage.read();

import { getImage } from 'astro:assets';

const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/hero-images/*');
const resolveImage = async (imagePath: string | undefined) => {
  if (!imagePath) return null;
  const key = imagePath.replace('@/', '/src/');
  const loader = images[key];
  if (!loader) {
      console.warn(`Image not found for path: ${imagePath} (key: ${key})`);
      return null;
  }
  const mod = await loader();
  const optimized = await getImage({ src: mod.default, format: 'webp', width: 1920 });
  return optimized.src;
};
const heroBgImage = await resolveImage(homepageData?.heroBackgroundImage);
---

<Layout title="Wijaya Partners | Commercial Litigation & Advisory" fullScreen={true}>
	<Hero 
		client:load 
		heading={homepageData?.heroHeading}
		headingHighlight={homepageData?.heroHeadingHighlight}
		subheading={homepageData?.heroSubheading}
        backgroundImage={heroBgImage}
	/>
</Layout>
